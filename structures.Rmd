---
title: "structures"
author: "Erica Johnson"
date: "11/20/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r, include = FALSE}
library(tidyverse)
library(dplyr)

```

For the stormwater structures, also used interchangeably in SWMM as Junctions or Nodes, we will select relevant columns, rename them and assign inver elevations to them. Invert elevation is how SWMM knows where the water should flow in a gravity fed system The Elevation column is actually "inver elevation".

See SWMM example below:

[JUNCTIONS]					
;;Name  Elevation MaxDepth  InitDepth SurDepth  Aponded   
;;--------------	----------	----------	----------	
22503	0	0	0	0	8.5
```{r}
#only 9 out of 910 have values for invert elevation. This is an issue for the SWMM model. some "quick fix" testing is being done to so what kind of invert elevations work with the model...

structure_data <- read_csv("Structure_XY_Elev.csv") 
 



```

```{r}
#CATCHMENT_ is actually "CATCHMENT_DROP" according to the  USGS data. DRAINAGE_A is drainage area. Catchment and drainage areas are usually used interchangeably, and there doesn't seem to be a definition for catchment drop is USGS. 

#I think catchment drop is depth of the catchment. For this reason, I will use drainage area for area ponded value that SWMM takes and CATCHMENT_DROP as MaxDepth.

#"Elevation" for the structures in SWMM is actually "Invert Elevation". Only 9 out of 950 structures have a value for invert elevation, so we will make use the elevation values from RASTERVALU column.

junctions_data <- structure_data %>% select(OBJECTID, RASTERVALU, CATCHMENT_, DRAINAGE_A, POINT_X, POINT_Y) %>% 
  rename(Name = OBJECTID, Elevation = RASTERVALU, MaxDepth = CATCHMENT_, Aponded = DRAINAGE_A, X_Coord = POINT_X, Y_Coord = POINT_Y) %>% mutate(Invert_Elev = 1025.880859-Elevation) %>% mutate(MaxDepth = replace_na(MaxDepth, 0)) %>% mutate(Aponded = replace_na(MaxDepth, 0))

# What we want to preserve here is there elevation related to each other, but SWMM will only work with invert elevation. mutate elevation values to invert elevation values by subtracting each structure elevation from the highest elevation value in the dataset. Looking at the dataset, the highest elevation value is 1025.880859. 

#SWMM also only takes 0, no blanks or NAs, so we have mutated NA vlues in MaxDepth and Aponded to 0


#add columns
junctions_data$InitDepth <- 0
junctions_data$SurDepth <- 0

```

```{r}
#arrange columns
junctions <- select(junctions_data, Name, Invert_Elev ,MaxDepth, InitDepth, SurDepth,Aponded)
```


```{r}
write.csv(junctions,"Wailupe_junctions_SWMM.csv", row.names = FALSE)
   
```

Next we need to make a file with the xy coordinates of the structures so SWMM knows where to put them.

See SWMM example below:
[COORDINATES]		
;;Node          	X-Coord           	Y-Coord           
;;--------------	------------------	------------------
22503	1720700.042	41573.305
```{r}

#SWMM columns we need are: Node	X-Coord	Y-Coord
coordinates <- junctions_data %>% select (Name, X_Coord, Y_Coord) %>% rename (Node = Name)

```

```{r}
write.csv(coordinates,"Wailupe_coordinates_SWMM.csv", row.names = FALSE)
```


